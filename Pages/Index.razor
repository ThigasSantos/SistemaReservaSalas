@page "/"
@inject SalaServices service
@inject IJSRuntime JsRuntime
@inject NavigationManager navigationManager
@inject StateContainer stateContainer

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha384-ezVWzzRC8OXfGr4zUqZoLkAAjjLygRhHpPdHfPySExL39wBL6UVeP2bAAMHDUZ1D" crossorigin="anonymous">
    <title>Sala de Reservas</title>
</head>

<body>
    <!-- Cabeçalho -->
    <header>
        <h1>Sistema de Reservas de Salas</h1>
        <div class="account-info">
            <span>Minha Conta</span>
            <a href="#">Sair</a>
        </div>
    </header>

    <!-- Salas e Reservas -->
    <div class="container">

        <!-- Sala List -->
        <div id="rooms-container">
            <h2>Lista de Salas</h2>
            <!-- Sala items will be added dynamically here -->
            @if (Salas.Any())
            {
                @foreach (var sala in Salas)
                {
                    <div class="room-item" onclick="showRoomReservations(@sala.Id)">@sala.Nome
                        <div class="room-item">
                            <button @onclick="() => EditarSala(sala)">
                                <i class="fas fa-pencil-alt"></i> <!-- Ícone de lápis da FontAwesome -->
                            </button>
                            <button @onclick="() => ApagarSala(sala)">
                                <i class="fas fa-trash-alt"></i> <!-- Ícone de lixeira da FontAwesome -->
                            </button>
                        </div>
                    </div>
                }
            }
            <button id="add-room-btn" onclick="showRoomForm()">Cadastrar Sala</button>
        </div>

        <!-- Reserva List -->
        <div id="reservations-container">
            <!-- Reserva items will be added dynamically here -->
            <button id="back-btn" onclick="backToRooms()">Voltar</button>
        </div>

        <!-- Detalhes da Sala ou Cadastro de Sala -->
        <div id="room-form">
            <h2>Informações Sala</h2>
            <div class="form-group">
                <label for="room-name">Nome da Sala:</label>
                <input type="text" id="room-name" @bind-value="@Room.Nome" required>
                <label for="room-capacity">Capacidade:</label>
                <input type="number" id="room-capacity" @bind="@Room.Capacidade" required>
                <label for="room-description">Descrição:</label>
                <input type="text" id="room-description" @bind="@Room.Descricao" required>
            </div>
            <div class="form-group">
                <button @onclick="AdicionarSala">Salvar</button>
            </div>
            <button id="back-btn" onclick="hideRoomForm()">Cancelar</button>
        </div>

    </div>
</body>
<script>
    function backToRooms() {
        // Reset the content and display the rooms-container
        document.getElementById('reservations-container').innerHTML = '';
        document.getElementById('reservations-container').style.display = 'none';
    }

    function showRoomForm() {
        // Display the room-form
        document.getElementById('room-form').style.display = 'block';
    }

    function showRoomReservations(roomName) {
        // Display the reservations-container
        document.getElementById('reservations-container').style.display = 'block';
        // Add the room name to the reservations-container
        document.getElementById('reservations-container').innerHTML = '<h2>Reservas da ' + roomName + '</h2>';
    }

    function showRoomEditForm(roomName, roomCapacity, roomDescription) {
        // Display the room-form
        document.getElementById('room-form').style.display = 'block';
        // Add the room name to the room-form
        document.getElementById('room-name').value = roomName;
        document.getElementById('room-capacity').value = roomCapacity;
        document.getElementById('room-description').value = roomDescription;
    }

    function hideRoomForm() {
        // Reset the content and hide the room-form
        document.getElementById('room-form').style.display = 'none';
        document.getElementById('room-name').value = '';
        document.getElementById('room-capacity').value = '';
        document.getElementById('room-description').value = '';
    }
</script>

@code {

    List<Sala> Salas = new List<Sala>();
    Sala Room { get; set; } = new();
    protected override async Task OnInitializedAsync()
    {
        await AtualizaSalas();
    }

    private async Task AtualizaSalas()
    {
        Salas = await service.RetornaSalaAsync();
    }

    private async void EditarSala(Sala sala)
    {
        stateContainer.AtualizaSala(sala);
        await JsRuntime.InvokeVoidAsync("showRoomEditForm", sala.Nome, sala.Capacidade, sala.Descricao);
    }

    private async Task AdicionarSala()
    {
        string mensagem;
        if (stateContainer.sala is null)
        {
            Room.Ativo = true;
            await service.AddRoomAsync(Room);
            mensagem = "Produto salvo com sucesso";
        }else
        {
            await service.UpdateRoomAsync(Room);
            mensagem = "Produto atualizado com sucesso";
            stateContainer.sala = null;
        }
        Room = new();
        await AtualizaSalas();
        JsRuntime.InvokeVoidAsync("hideRoomForm", "room-form");
    }
    private async Task ApagarSala(Sala sala)
    {
        bool confirmed = await JsRuntime.InvokeAsync<bool>("confirm", "Você tem certeza que deseja apagar a sala ?"); // Confirm
        if (confirmed)
        {
            await service.DeleteRoomAsync(sala);
            await AtualizaSalas();
            await JsRuntime.InvokeVoidAsync("alert", "Sala Deletada!");
        }
    }
}